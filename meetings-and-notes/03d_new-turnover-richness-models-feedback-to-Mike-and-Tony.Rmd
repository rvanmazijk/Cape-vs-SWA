---
title: Tables and figures
subtitle: Cape vs SWA publication
author: Ruan van Mazijk
date: '`r format(Sys.time(), "%F")`'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  cache = TRUE,
  eval = TRUE,
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.height = 3,
  fig.width = 5
)
```

```{r, include=FALSE}
source(here::here("setup.R"))
source(here::here("data/01_import-region-polygons.R"))
source(here::here("data/02_import-floral-data.R"))
GCFR_spp <- readOGR(here::here(
  "outputs/species-turnover-and-richness/GCFR_spp_2018-08-10"
))
SWAFR_spp <- readOGR(here::here(
  "outputs/species-turnover-and-richness/SWAFR_spp_2018-08-10"
))
names(GCFR_spp)[6:8] <-
  c("HDS_richness", "mean_QDS_richness", "mean_QDS_turnover")
names(SWAFR_spp)[6:8] <-
  c("HDS_richness", "mean_QDS_richness", "mean_QDS_turnover")
GCFR_spp_data <- GCFR_spp@data %>%
  select(hdgc, HDS_richness, mean_QDS_richness, mean_QDS_turnover) %>%
  distinct()
SWAFR_spp_data <- SWAFR_spp@data %>%
  select(hdgc, HDS_richness, mean_QDS_richness, mean_QDS_turnover) %>%
  distinct()
richness_turnover_data <- as_tibble(rbind(
  cbind(region = "Cape", GCFR_spp_data),
  cbind(region = "SWA", SWAFR_spp_data)
))
```

```{r, include=FALSE}
Cape_m0 <- lm(
  HDS_richness ~ 1,
  data = na.exclude(filter(richness_turnover_data, region == "Cape"))
)
Cape_m1 <- lm(
  HDS_richness ~ mean_QDS_richness,
  data = na.exclude(filter(richness_turnover_data, region == "Cape"))
)
Cape_m2 <- lm(
  HDS_richness ~ mean_QDS_richness + mean_QDS_turnover,
  data = na.exclude(filter(richness_turnover_data, region == "Cape"))
)
Cape_m3 <- lm(
  HDS_richness ~ mean_QDS_richness * mean_QDS_turnover,
  data = na.exclude(filter(richness_turnover_data, region == "Cape"))
)
SWA_m0 <- lm(
  HDS_richness ~ 1,
  data = na.exclude(filter(richness_turnover_data, region == "SWA"))
)
SWA_m1 <- lm(
  HDS_richness ~ mean_QDS_richness,
  data = na.exclude(filter(richness_turnover_data, region == "SWA"))
)
SWA_m2 <- lm(
  HDS_richness ~ mean_QDS_richness + mean_QDS_turnover,
  data = na.exclude(filter(richness_turnover_data, region == "SWA"))
)
SWA_m3 <- lm(
  HDS_richness ~ mean_QDS_richness * mean_QDS_turnover,
  data = na.exclude(filter(richness_turnover_data, region == "SWA"))
)
```

```{r}
Cape_models <- 
  anova(Cape_m0, Cape_m1, Cape_m2, Cape_m3, test = "LRT") %>%
  cbind(model = c("Cape_m0", "Cape_m1", "Cape_m2", "Cape_m3"), .)
SWA_models <- 
  anova(SWA_m0, SWA_m1, SWA_m2, SWA_m3, test = "LRT") %>%
  cbind(model = c("SWA_m0", "SWA_m1", "SWA_m2", "SWA_m3"), .)
rbind(Cape_models, SWA_models) %>%
  remove_rownames() %>%
  knitr::kable(booktabs = TRUE, format = "latex", caption = "LRT of models. Each row represents the change in signficance etc. of that model relative to the one directly above it (models are nested).") %>%
  kableExtra::group_rows("Cape models", 1, 4) %>%
  kableExtra::group_rows("SWA models", 5, 8)
```

```{r}
Cape_AICs <-
  AIC(Cape_m0, Cape_m1, Cape_m2, Cape_m3) %>%
  cbind(model = rownames(.), .) %>%
  as_tibble()
SWA_AICs <-
  AIC(SWA_m0, SWA_m1, SWA_m2, SWA_m3) %>%
  cbind(model = rownames(.), .) %>%
  as_tibble()
rbind(Cape_AICs, SWA_AICs) %>%
  mutate(DeltaAIC = AIC - min(AIC)) %>%
  rename(k = df) %>%
  knitr::kable(booktabs = TRUE,  format = "latex", caption = "Delta AIC-scores of models.") %>%
  kableExtra::group_rows("Cape models", 1, 4) %>%
  kableExtra::group_rows("SWA models", 5, 8)
```

```{r}
rbind(tidy(Cape_m3), tidy(SWA_m3)) %>%
  knitr::kable(booktabs = TRUE, format = "latex", caption = "Cape and SWA models no. 3") %>%
  kableExtra::group_rows("Cape models", 1, 4) %>%
  kableExtra::group_rows("SWA models", 5, 8)
```

```{r, out.width="10cm", fig.cap="Mean QDS richness = 3000 and HDS richness = 1500... How??"}
knitr::include_graphics("/Users/ruanvanmazijk/projects/Cape-vs-SWA/figures/fig-2-richness-vs-turnover_for-feedback-for-Mike-and-Tony.png")
```

```{r, fig.cap="Newly generated mean QDS richness vs HDS richness"}
richness_turnover_data %>%
  na.exclude() %>%
  ggplot(aes(mean_QDS_richness, HDS_richness, col = region)) +
    geom_point() +
    geom_smooth(method = lm) +
    labs(
      x = "Mean QDS richness",
      y = "HDS richness"
    ) +
    scale_colour_manual(name = "Region", values = my_palette)
```

```{r, fig.cap="Newly generated mean QDS turnover vs HDS richness"}
richness_turnover_data %>%
  na.exclude() %>%
  ggplot(aes(mean_QDS_turnover, HDS_richness, col = region)) +
    geom_point() +
    geom_smooth(method = lm) +
    labs(
      x = "Mean QDS turnover",
      y = "HDS richness"
    ) +
    scale_colour_manual(name = "Region", values = my_palette)
```

```{r, fig.cap="Cape model no. 3"}
Cape_m3 %>%
  visreg::visreg(
    xvar = "mean_QDS_richness",
    by = "mean_QDS_turnover",
    overlay = TRUE,
    gg = TRUE,
    breaks = c(0.70, 0.85, 1.00)
  ) +
  labs(
    x = "Mean QDS richness",
    y = "HDS richness"
  ) +
  guides(
    col = guide_legend(title = "Mean QDS turnover"),
    fill = guide_legend(title = "Mean QDS turnover")
  )
```

```{r, fig.cap="SWA model no. 3"}
SWA_m3 %>%
  visreg::visreg(
    xvar = "mean_QDS_richness",
    by = "mean_QDS_turnover",
    overlay = TRUE,
    gg = TRUE,
    breaks = c(0.70, 0.85, 1.00)
  ) +
  labs(
    x = "Mean QDS richness",
    y = "HDS richness"
  ) +
  guides(
    col = guide_legend(title = "Mean QDS turnover"),
    fill = guide_legend(title = "Mean QDS turnover")
  )
```
