---
title: Exploring different turnover metrics
subtitle: Cape vs SWA publication
author: Ruan van Mazijk
date: '`r Sys.Date()`'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
```

Symbol           | Description                       | Derivation
-----------------|-----------------------------------|------------
$A$              | No. species in site 1             |
$B$              | No. species in site 2             |
$J$ ($\equiv a$) | No. species shared by sites 1 & 2 | $|A \cap B|$
$b$              | No. species exclusively in site 1 | $|A - J|$
$c$              | No. species exclusively in site 2 | $|B - J|$

Table: Glossary

# Definitions of turnover &/or similarity

Jaccard distance (`vegan::vegdist(x, method = "Jaccard")`)

$$
  \beta_{d_J} = \frac{A + B - 2J}{A + B - J}
$$

Jaccard similarity (Koleff et al. 2003. _J. Anim. Ecol._ 72(3))

$$
  \beta_{s_J} = \frac{a}{a + b + c}
$$

_(Note: $\beta_{d_J} = 1 - \beta_{s_J}$)_

$\beta_{g}$ distance (Gaston et al. 2001 in Koleff et al. 2003. _J. Anim. Ecol._ 72(3))

$$
  \beta_{d_g} = \frac{b + c}{a + b + c}
$$

$\beta_{gl}$ distance (Lennon et al. 2001 _J. Anim. Ecol._ 70(6))

$$
  \beta_{d_{gl}} = \frac{2|b - c|}{2a + b + c}
$$

# Expressing turnover in common terms

As above,

$$
  \beta_{d_J} = \frac{A + B - 2J}{A + B - J}
$$

Thus, given the indentities in Table 1,

\begin{align*}
  \beta_{d_g}
    &= \frac{b + c}{a + b + c} \\
    &= \frac{(A - J) + (B - J)}{J + (A - J) + (B - J)} \\
    &= \frac{A + B - 2J}{A + B - J} \\
  &\therefore \beta_{d_g} \equiv \beta_{d_J}
\end{align*}

And,

\begin{align*}
  \beta_{d_{gl}}
    &= \frac{2|b - c|}{2a + b + c} \\
    &= \frac{2|(A - J) - (B - J)|}{2J + (A - J) + (B - J)} \\
    &= \frac{2|A - B|}{A + B} \\
\end{align*}

Also, Bray-Curtis distance (`vegan::vegdist(x, method = "bray")`) can be derived from Jaccard distance, as, given by `?vegan::vegdist`

$$
  \beta_{d_J} = \frac{2\beta_{d_{BC}}}{1 + \beta_{d_{BC}}}
$$

Thus,

$$
  \beta_{d_{BC}} = \frac{-\beta_{d_J}}{\beta_{d_J} - 2}
$$

Also, as in Table 1, let $b = |A - J|$ and $c = |B - J|$. Thus,

\begin{align*}
  |A \cup B| 
    &= a + b + c
    & = J + |A - J| + |B - J| 
    & = A + B - J
\end{align*}

....

```{r J-vs-BC-simulation}
J_dists <- seq(0, 1, 0.01)
BC_dists <- (-J_dists) / (J_dists - 2)
plot(
  J_dists, BC_dists,
  xlab = bquote(beta[d[J]]), 
  ylab = bquote(beta[d[BC]])
)
```

...

```{r many-metrics-simulation}
data <- 
  expand.grid(A = 1:10, B = 1:10, J = 0:10) %>%
  filter(J <= A, J <= B) %>%
  mutate(
    total_richness = A + B - J,
    no_shared      = J,
    no_diff        = A + B - 2*J,
    prop_shared    = J / (A + B - J),  # = 1 - J_dist
    J_dist         = (A + B - 2*J) / (A + B - J),  # = "prop_diff"
    BC_dist        = (-J_dist) / (J_dist - 2),
    gl_dist        = (2*abs(A - B)) / (A + B)
  ) %>%
  gather(param, param_value, A, B, J) %>%
  gather(metric, metric_value, -param, -param_value)
ggplot(data, aes(param_value, metric_value)) +
  geom_point(alpha = 0.25) +
  facet_grid(metric ~ param, scales = "free_y")
```
