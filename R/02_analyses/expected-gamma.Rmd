---
title: Demonstrating $\gamma$ decreases with increasing $\beta$
subtitle: Cape vs SWA publication
author: Ruan van Mazijk
date: '`r Sys.Date()`'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  fig.width = 4, fig.height = 3
)
library(tidyverse)
library(viridis)
theme_set(theme_bw() + theme(
  panel.background = element_rect(fill = "white"),
  panel.border = element_rect(fill = NA, colour = "black")
))
```

Define a simple Jaccard distance function

```{r def-jacc}
jacc_dist <- function(a, b) {
  1 - (length(intersect(a, b)) / length(union(a, b)))
}
```

Create a species pool of richness $n$ (analogous to the Cape or SWA)

```{r species-pool}
n <- 1000
region <- 1:n
```

Define the range of richnesses $m$ of the communities to draw from the pool (starting from stupidly a small 1 and ending at $\frac{1}{2}$ of regional richnes)

```{r m}
data <- data.frame(m = 1:(0.5 * n))
```

Draw communites $a$ and $b$ (a and b are analogous to smaller pixels, e.g. QDS), each of richness $m$, and calculate the richness $\gamma$ of the larger scale community $a + b$ (analogous to the larger scale pixel, e.g. HDS), and the turnover between $a$ and $b$ (i.e. the turnover "within" the larger scale community)

```{r generate-communities}
# Create empty columns to store results
data$richness_ab <- NA
data$jacc_dist_ab <- NA
for (m in data$m) {
  a <- sample(region, m)
  b <- sample(region, m)
  ab <- c(a, b)
  richness_ab <- length(unique(ab))
  jacc_dist_ab <- jacc_dist(a, b)
  # Store results in dataframe
  data$richness_ab[[m]] <- richness_ab
  data$jacc_dist_ab[[m]] <- jacc_dist_ab
  # Store adjusted results in dataframe too
  data$richness_ab_m_adjusted[[m]] <- richness_ab / m
  data$richness_ab_jacc_adjusted[[m]] <- richness_ab / jacc_dist_ab
}
```

```{r gamma-vs-alpha, echo=FALSE, fig.cap="Plot of $\\gamma$ as a function of $\\alpha$"}
ggplot(data, aes(m, richness_ab)) +
  geom_point() +
  labs(x = "m", y = "S(A+B)")
```

```{r gamma-vs-beta, echo=FALSE, fig.cap="Plot of $\\gamma$ as a function of $\\beta$"}
ggplot(data, aes(jacc_dist_ab, richness_ab)) +
  geom_point() +
  labs(x = "J(A,B)", y = "S(A+B)")
```

```{r gamma-vs-alpha-adj, echo=FALSE, fig.cap="Plot of $\\gamma_{adj by \\beta}$ as a function of $\\alpha$"}
ggplot(data, aes(m, richness_ab_jacc_adjusted, col = jacc_dist_ab)) +
  geom_point() +
    labs(x = "m", y = "S(A+B) / J(A,B)") +
    scale_color_viridis(name = "J(A,B)")
```

```{r gamma-vs-beta-adj, echo=FALSE, fig.cap="Plot of $\\gamma_{adj by \\alpha}$ as a function of $\\beta$"}
ggplot(data, aes(jacc_dist_ab, richness_ab_m_adjusted, col = m)) +
  geom_point() +
  labs(x = "J(A,B)", y = "S(A+B) / m") +
  scale_color_viridis()
```
