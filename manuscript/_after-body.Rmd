<!--After-body content (Biosketches, Author contributions, Tables, Figures)-->

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  eval = TRUE,
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```

```{r setup-tables, include=FALSE}

source(here::here("setup.R"))

# Table 1 ----------------------------------------------------------------------

data_sources <- read_csv(here::here("manuscript/data-sources.csv"))

# Table 2 ----------------------------------------------------------------------

import_objects(
  here::here("outputs/species-turnover-w-distance/"),
  ignore_RDS = TRUE
)
tidy_terms <- c(
  "Intercept",
  "$log($Distance between cells$)$",
  "Cape",
  "$log($Distance between cells$)$ $\\times$ Cape"
)
turnover_vs_geodist_model_table <- my_model_table(
  model_tidy = species_turnover_geodist_m_tidy,
  tidy_terms = tidy_terms
)

# Table 3 ----------------------------------------------------------------------

import_objects(
  here::here("outputs/species-turnover-and-richness/")
)
tidy_terms <- c(
  "Intercept",
  "$log(\\overline{S_{QDS}} + 1)$",
  "$\\overline{J_{QDS}}$",
  "SWA",
  "$log(\\overline{S_{QDS}} + 1) \\times$ SWA",
  "$\\overline{J_{QDS}} \\times$ SWA"
)
species_model_table <- my_model_table(
  model = species_turnover_richness_HDS_m,
  tidy_terms = tidy_terms,
  AIC_table = species_HDS_AIC_table
)

# Table 4 ----------------------------------------------------------------------

import_objects(
  here::here("outputs/species-and-roughness/"),
  ignore_RDS = TRUE
)
species_roughness_AICc <- bind_rows(.id = "region", list(
  Cape = GCFR_models_AICc_all,
  SWA = SWAFR_models_AICc_all,
  Both = combined_models_AICc_all
))

```

\break

# Biosketches {-}

**Ruan van Mazijk** is a Masters student broadly interested in comparative biology and ...<!--TODO: finish-->

**Michael D. Cramer** <!--TODO-->

**G. Anthony Verboom** <!--TODO-->

# Author contributions {-}

MDC and GAV conceived the study question, which RVM investigated under their supervision for his BSc Hons project. The analyses and programming work were largely devised by RVM, with input from the other authors, and was carried out by RVM. RVM wrote the first draft of the manuscript and all authors contributed equally thereafter.

\break

# Tables {-}

```{r data-sources, results="asis"}
data_sources %>%
  knitr::kable(
    booktabs = TRUE,
    caption = "(ref:data-sources)"
  ) %>%
  kableExtra::kable_styling(latex_options = "hold_position")
# TODO: use kableExtra::group_rows() a.o.t. these cheat-rows!
```

```{r turnover-vs-geodist-model-table, results="asis"}
turnover_vs_geodist_model_table %>%
  magrittr::extract("model_table") %>%
  knitr::kable(
    escape = FALSE,
    booktabs = TRUE,
    caption = "(ref:turnover-vs-geodist-model-table)"
  ) %>%
  kableExtra::kable_styling(latex_options = "hold_position")
```

```{r species-model-table, results="asis"}
species_model_table %>%
  magrittr::extract("model_table") %>%
  knitr::kable(
    escape = FALSE,
    booktabs = TRUE,
    align = c("l", "r", "r"),
    caption = "(ref:species-model-table)"
  ) %>%
  kableExtra::kable_styling(latex_options = "hold_position")
```

<!--
NOTE: do I need this? Maybe as supplementary?

```{r species-model-table-3QDS, results="asis"}
out <- my_model_table(
  model = species_turnover_richness_3QDS_m,
  tidy_terms = tidy_terms,  # from previous chunk
  AIC_table = species_3QDS_AIC_table
)
out %>%
  magrittr::extract("model_table") %>%
  knitr::kable(
    escape = FALSE,
    booktabs = TRUE,
    align = c("l", "r", "r"),
    caption = "(ref:species-model-table-3QDS)"
  ) %>%
  kableExtra::kable_styling(latex_options = "hold_position")
```

(ref:species-model-table-3QDS) Estimated coefficients and significances ($P$-value) following multiple linear regression of 3QDS species richness ($S_{3QDS}$) against the mean QDS richness ($\overline{S_{QDS}}$) ($log(x + 1)$-transformed) and turnover ($\overline{J_{QDS}}$, as Jaccards distance) within a given HDS, of the form in Equation \@ref(eq:S-HDS-formula).
The Cape was fit as the baseline, hence the SWA represents the categorical term here.
These models were better fitting than similar models without region categories ($\Delta AIC =$ `r out$deltaAIC`).
Note, this model does not represent those curves plot in Figures \@ref(fig:richness-vs-turnover)B,C and \@ref(fig:richness-vs-turnover-3QDS) (there, the curves are from simple linear regressions of the variables in each panel, separated by region).

-->

```{r species-roughness-AICc, results="asis"}
species_roughness_AICc %>%
  mutate(model = case_when(
    model == "null"     ~ "Null",
    model == "full"     ~ "All",
    model == "abs"      ~ "Absolute variables",
    model == "rough"    ~ "Roughness variables",
    model == "elev"     ~ "Elevation",
    model == "non_elev" ~ "Non-elevation variables",
    model == "soil"     ~ "Soil variables",
    model == "non_soil" ~ "Non-soil variables"
  )) %>%
  mutate_if(is.numeric, function(x) {
    x %>%
      round(digits = 2) %>%
      format(digits = 3, nsmall = 2)
  }) %>%
  arrange(region, delta_AICc) %>%
  select(-region) %>%
  knitr::kable(
    escape = FALSE,
    booktabs = TRUE,
    align = c("l", "r", "r", "r"),
    col.names = c("Model predictors", "$AICc$", "$\\Delta AICc$", "$w_{AICc}$"),
    caption = "(ref:species-roughness-AICc)"
  ) %>%
  kableExtra::group_rows("Cape:", 1, 8) %>%
  kableExtra::group_rows("SWA:", 9, 16) %>%
  kableExtra::group_rows("Both:", 17, 24) %>%
  kableExtra::kable_styling(latex_options = "hold_position")
```

\break

# Figures {-}

```{r roughness, fig.pos="H", out.width="18cm", fig.cap="(ref:roughness)"}
knitr::include_graphics(here::here("figures/fig-1-roughness_manual-edit4.png"))
```

```{r richness-vs-turnover, fig.pos="H", out.width="18cm", fig.cap="(ref:richness-vs-turnover)"}
knitr::include_graphics(here::here("figures/fig-2-richness-vs-turnover.png"))
```
