---
title: "Assessing collinearity among environmental and environmental heterogeneity predictor variables"
subtitle: |
  | Supplementary Information
  | Cape vs SWA publication
author: "Ruan van Mazijk"
date: "`r Sys.Date()`"
mainfont: Times New Roman  # for PDF
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, out.width = "18cm")
library(here)
source(here("R/setup.R"))
library(png)
```

```{r helper-functions}
crop_png <- function(png_matrix,
                     min_row_frac = 0, max_row_frac = 1,
                     min_col_frac = 0, max_col_frac = 1) {
  from_row <- (min_row_frac * nrow(png_matrix))
  to_row   <- (max_row_frac * nrow(png_matrix))
  from_col <- (min_col_frac * ncol(png_matrix))
  to_col   <- (max_col_frac * ncol(png_matrix))
  magrittr::extract(png_matrix, from_row:to_row, from_col:to_col, )
  # Note 3rd dimension b/c PNG-matrices have 3 slices (RGB)
}
import_png <- function(file) {
  file %>%
    readPNG() %>%
    crop_png(0.09) %>%  # remove the title from removeCollinearity()-plots
    as.raster() %>%
    rasterGrob(interpolate = FALSE)
}
```

```{r assemble-collinearity-dendrogram-plots}
figure_dir <- here("outputs/species-environment-relationships")
figure_names <- c(
  "Cape_collinearity-check_0.8-cutoff_QDS.png",
  "Cape_collinearity-check_0.8-cutoff_HDS.png",
  "SWA_collinearity-check_0.8-cutoff_QDS.png",
  "SWA_collinearity-check_0.8-cutoff_HDS.png"
)
figure_paths <- glue("{figure_dir}/{figure_names}")
figures <- map(figure_paths, import_png)
```

```{r make-and-save-figure}
regions <- c("Cape", "Cape", "SWA", "SWA")
scales <- c("QDS", "HDS", "QDS", "HDS")
panel_labels <- glue("({letters[1:4]}) {regions} {scales}")
panelled_figure <- plot_grid(
  plotlist = figures, 
  labels = panel_labels
)
panelled_figure_path <- here(
  "manuscript/supplementary-information",
  "panelled-collinearity-figure.png"
)
ggsave(
  panelled_figure_path,
  panelled_figure, 
  width = 10, height = 8, 
  dpi = 300
)
```

```{r plot-figure, fig.cap="Dendrograms depicting correlation between environmental variables in the Cape (= Greater Cape Floristic Region; a--c) and SWA (= Southwest Australia Floristic Region; d--f), generated by the \"removeCollinearity\" function in the R package \"virtualspecies\". The vertical axis represents $1 -$ Pearson's $r$, such that more correlated variables are clustered together. Clusters of environmental variables that are $\\geq 0.8$ similar (Pearson's $r$) are enclosed in red boxes. The first variable in each cluster, when listed alphabetically, was used within our boosted regression tree (BRT) analyses."}
knitr::include_graphics(panelled_figure_path)
```
